package io.github.burakkaygusuz.scanner;

import io.github.burakkaygusuz.config.ScannerConfig;
import io.github.burakkaygusuz.detector.SensitiveInfoDetector;
import io.github.burakkaygusuz.detector.SqlInjectionDetector;
import io.github.burakkaygusuz.detector.XssDetector;
import io.github.burakkaygusuz.service.HttpClientService;
import io.github.burakkaygusuz.service.ReportService;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class VulnerabilityScanner {

  private final SqlInjectionDetector sqlInjectionDetector;
  private final XssDetector xssDetector;
  private final SensitiveInfoDetector sensitiveInfoDetector;
  private final ExecutorService executor;

  public VulnerabilityScanner(
      ScannerConfig config, HttpClientService httpClientService, ReportService reportService) {
    this.sqlInjectionDetector = new SqlInjectionDetector(config, httpClientService, reportService);
    this.xssDetector = new XssDetector(config, httpClientService, reportService);
    this.sensitiveInfoDetector =
        new SensitiveInfoDetector(config, httpClientService, reportService);
    this.executor = Executors.newVirtualThreadPerTaskExecutor();
  }

  public void scanUrl(String url) {
    executor.submit(() -> sqlInjectionDetector.checkSqlInjection(url));
    executor.submit(() -> xssDetector.checkXss(url));
    executor.submit(() -> sensitiveInfoDetector.checkSensitiveInfo(url));
  }

  public void shutdown() {
    executor.shutdown();
  }

  public ExecutorService getExecutor() {
    return executor;
  }
}
